4/20(土) 10：00  　

22-23章の質問・前回のフィードバックを踏まえての確認を一緒にお願いします。

22-10  php22/practice_bbs_func_intermediate.php

要件確認済み　フィードバック部分
insert関数の　クエリ失敗時にどうするのか考える。適切な戻り値を考える。
→関数の処理結果を変数なりなんなりに入れて受け取るようにする。

→フィードバック内容
関数の返り値として
　　false, trueを返すことができる
if 条件分岐を作り、falseであれば、$error配列に文字列を入れる。


以前の内容
$error[] = insert_table($name, $comment, $link);

//insert_table($name, $comment, $link)
の戻り値が返る場合はクエリ実行が失敗した時のみであり、$error[]に中身が入ってリターンされるので
中身はエラー内容である。そのため受け取りを行う変数は$error[]であれば自然であると考えた。

23-7課題クリア

23-8 tool.php 質問 mvc/tool.php
if (empty($error))　内でinsertが二回続く場面　
$resultフラグを用いて、trueが返り値として戻らなければ、次のinsertができないようにしている。
二回目のinsertが成功し$resultの中身がtrueのままであれば、
処理が確定するようにしているがこれでよいのか。

→フィードバック内容
63行目　// 新しく追加した商品のdrink_idを取得
            $drink_id = mysqli_insert_id($link);
            これは上記クエリが成功していても失敗していても実行されてしまう形になっている。
なので、上記　クエリ実行で成功し　戻り値としてtrueが帰ってくるのなら
    $drink_id = mysqli_insert_id($link);　をできるようにする。

    if((insert_information_table($name, $price, $date, $status, $file, $link)) === true){
         $drink_id = mysqli_insert_id($link);
    }
みたいな感じかな。関数内修正必要だけど
んで　else(上記クエリ実行が成功している場合　trueを返している場合は)
次のinsert()につなげるようにしていく
入れ子構造にする。
どちらのクエリ実行も失敗すればfalseを返し、$errorを吐くようにする。
そうすることで、if(empty($error))へとつなげていき処理を確定する。
やり方は、テキストを参照　トランザクションの部分に書いてありそう

※変数の命名規則は変数を使うのであれば厳密に分ける。
_アンダーバー一個くらい　$result_何とかテーブルみたいに
ex おすすめは型を頭に付ける　array_datasとかのように
$result === true
 $result = '新規商品追加成功';
同じ変数名なのに入っている値の型が異なる紛らわしいので名前を分ける。




23章　result.php 質問　moneyのバリデーションについて mvc/result.php
二か所でmoneyのバリデーションを行っている。$money_resultを用いて、
上記のバリデーションを問題がない場合のみ　
下記バリデーションが行えるようにしている。
$_POST['money']に対するエラーの重複を防ぐために実施しているがこれでよいのか。



フィードバック内容
→ループ処理にてデータを取り出す作業はいらない
$drink_data{status'}のように直に書き出して来ればよい。

エラーと正常判定をしっかり分ける。
先生の前回のコードを見ながら復習していく。